@page
@model DotnetAPI.Pages.Auth.IndexModel

<h2>Sign In</h2>
<form id="loginForm">
    <input id="UserNameOrEmail" placeholder="Username or Email" required />
    <input id="Password" type="password" placeholder="Password" required />
    <button type="submit">Sign In</button>
</form>
<div id="loginResult"></div>

<script>
document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const data = {
        UserNameOrEmail: document.getElementById('UserNameOrEmail').value,
        Password: document.getElementById('Password').value
    };
    const response = await fetch('/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    });
    const resultDiv = document.getElementById('loginResult');
    if (response.ok) {
        const result = await response.json();
        // Save the token in a cookie accessible by the backend
        document.cookie = "jwtToken=" + result.token + "; path=/";
        resultDiv.textContent = "Login successful. Redirecting...";
        window.location.href = "/Admin/index";
    } else {
        resultDiv.textContent = "Incorrect username or password.";
    }
});
</script>

<h2>Register</h2>
<form id="registerForm">
    <div>
        <label for="RegisterUserName">Username:</label>
        <input id="RegisterUserName" name="RegisterUserName" required />
    </div>
    <div>
        <label for="RegisterEmail">Email:</label>
        <input id="RegisterEmail" name="RegisterEmail" type="email" required />
    </div>
    <div>
        <label for="RegisterPassword">Password:</label>
        <input id="RegisterPassword" name="RegisterPassword" type="password" required />
    </div>
    <button type="submit">Register</button>
</form>
<div id="registerResult"></div>

<script>
document.getElementById('registerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const data = {
        UserName: document.getElementById('RegisterUserName').value,
        Email: document.getElementById('RegisterEmail').value,
        Password: document.getElementById('RegisterPassword').value
    };
    const response = await fetch('/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    });
    const resultDiv = document.getElementById('registerResult');
    if (response.ok) {
        const result = await response.json();
        resultDiv.textContent = result.message || "Registration successful.";
    } else {
        const error = await response.json().catch(() => null);
        resultDiv.textContent = error?.message || "Error registering user.";
    }
});
</script>

